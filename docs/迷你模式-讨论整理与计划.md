# 迷你模式：讨论整理与阶段计划（更新）

最后更新：2025-10-17

本文件汇总迷你模式（悬浮球 + 环形菜单）的已讨论结论，并给出明确的 P0/P1/P2 阶段计划与验收标准。重点调整：将“全屏透明宿主窗口”从“可选/实验”提升为 P0 必须项。

---

## 1. 目标
- 提升交互稳定性：避免双触发、无偏移展开/收起。
- 视觉与性能：在高 DPI、多显示器环境下保持一致、流畅。
- 架构弹性：为插件与后续动画/可访问性预留。

---

## 2. 关键结论（摘要）
- 全屏透明宿主窗口：作为 Mini 模式默认宿主（P0 必须）。窗口全屏、背景透明；仅球/菜单区域命中，其他区域点击穿透到下层应用。详见 docs/迷你模式-全屏透明窗口可行性与设计.md。
- DPI 无偏移：不再依赖改变 Window 尺寸/位置来展开/收起；在全屏宿主下通过视图层变换实现，天然规避漂移。
- 触发路径统一：子项点击事件内 e.Handled = true，父级仅兜底命中。

---

## 3. 阶段计划

### P0（当前迭代，必须项）
- 宿主窗口：
  - Mini 模式默认启用“全屏透明 + 局部命中（仅球/菜单）”。
  - 保留“传统小窗口”作为回退策略（设置可切换，热切换优先）。
- 交互与行为：
  - 长按阈值可配置；短按展开/空白收起；ESC 收起。
  - 子项点击仅触发一次；可选触发后自动收起。
- 图标与资源：
  - 内置 PNG、插件字节流、系统提取三路并存；失败有占位图。
- 文档与测试：
  - 覆盖 100%/125%/150% DPI 与单显示器场景的手测用例。

验收要点：
- 球外区域点击不拦截，能穿透到桌面/下层应用。
- 展开/收起无明显位置跳动；点击项仅触发一次。

### P1（近期迭代）
- 多显示器支持（每屏一窗或单窗覆盖），统一坐标与命中策略。
- 动画与细节：展开/收起淡入淡出、半径插值、遮罩策略优化。
- 设置 UI：宿主开关、阈值、半径/角度/项大小等。
- 结构优化：抽取 MiniInteractionController，增强可测试性。

### P2（中期）
- Alt+Tab/焦点策略细化（例如工具窗样式）；
- 平台级命中区域裁剪（Win32）按需引入；
- 性能调优与兼容适配（远程桌面、旧 GPU、截图工具）。

---

## 4. 风险与回退
- 兼容性差异导致穿透异常：提供设置开关即时回退到“传统小窗口”。
- 不同 GPU/驱动下透明合成差异：降低特效与动画范围。

---

## 5. 链接
- 实施细则：docs/迷你模式-全屏透明窗口可行性与设计.md
- 环形菜单：docs/环形菜单改造方案.md
- 总体方案：docs/迷你启动器修改方案.md
