<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="280" d:DesignHeight="200"
             x:Class="TodoListPlugin.Views.TodoCard">

    <UserControl.Styles>
        <!-- å¡ç‰‡æ ·å¼ -->
        <Style Selector="Border.todo-card">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BoxShadow" Value="0 4 12 2 #20000000"/>
            <Setter Property="ClipToBounds" Value="False"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style Selector="Border.todo-card:pointerover">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorSecondaryBrush}"/>
            <Setter Property="BoxShadow" Value="0 6 16 4 #30000000"/>
            <Setter Property="ClipToBounds" Value="False"/>
        </Style>

        <!-- æ‚¬åœæ”¾å¤§åŠ¨ç”» -->
        <Style Selector="Border.todo-card">
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2"/>
                    <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.2"/>
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Border.todo-card:pointerover">
            <Setter Property="RenderTransform" Value="scale(1.02)"/>
        </Style>

        <!-- æé†’å›¾æ ‡æ ·å¼ -->
        <Style Selector="ui|SymbolIcon.reminder-icon">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
        </Style>

        <!-- æ ‡ç­¾æ ·å¼ -->
        <Style Selector="Border.tag">
            <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="6,3"/>
        </Style>

        <Style Selector="Border.tag TextBlock">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
    </UserControl.Styles>

    <Border Classes="todo-card"
            Name="CardBorder"
            Width="280"
            ClipToBounds="False">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto">
            <!-- æ ‡é¢˜å’Œæé†’å›¾æ ‡ -->
            <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto">
                <TextBlock Grid.Column="0"
                           Name="TitleText"
                           Text="æ ‡é¢˜"
                           FontSize="15"
                           FontWeight="SemiBold"
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="Wrap"
                           MaxLines="2"
                           ToolTip.Tip="{Binding Text, RelativeSource={RelativeSource Self}}"/>

                <!-- æé†’å›¾æ ‡ -->
                <TextBlock Grid.Column="1"
                           Text="ðŸ””"
                           FontSize="14"
                           Name="ReminderIcon"
                           IsVisible="False"
                           Margin="8,0,0,0"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource AccentFillColorDefaultBrush}"
                           ToolTip.Tip="å·²è®¾ç½®æé†’"/>

                <!-- èœå•æŒ‰é’® -->
                <Button Grid.Column="2"
                        Name="MenuButton"
                        Padding="4"
                        Margin="4,0,0,0"
                        Background="Transparent"
                        BorderThickness="0">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuItem Header="ç¼–è¾‘" Name="EditMenuItem">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Edit"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="åˆ é™¤" Name="DeleteMenuItem">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Delete"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuFlyout>
                    </Button.Flyout>
                    <ui:SymbolIcon Symbol="MoreVertical" FontSize="14"/>
                </Button>
            </Grid>

            <!-- ç®€è¿° -->
            <TextBlock Grid.Row="1"
                       Name="DescriptionText"
                       Text="ç®€è¿°"
                       FontSize="12"
                       Opacity="0.7"
                       TextTrimming="CharacterEllipsis"
                       TextWrapping="Wrap"
                       MaxLines="3"
                       Margin="0,8,0,0"
                       ToolTip.Tip="{Binding Text, RelativeSource={RelativeSource Self}}"/>

            <!-- ä¼˜å…ˆçº§å’Œæ ‡ç­¾ -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        Spacing="8"
                        Margin="0,8,0,0">
                <!-- ä¼˜å…ˆçº§æŒ‰é’® -->
                <Button Name="PriorityButton"
                        Padding="8,4"
                        VerticalAlignment="Center"
                        ToolTip.Tip="ç‚¹å‡»ç®¡ç†ä¼˜å…ˆçº§">
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Width="250" Spacing="12">
                                <TextBlock Text="ç®¡ç†ä¼˜å…ˆçº§" FontSize="14" FontWeight="SemiBold"/>
                                
                                <StackPanel Spacing="4">
                                    <TextBlock Text="ä¼˜å…ˆçº§" FontSize="12" Opacity="0.7"/>
                                    <ComboBox Name="PriorityComboBox"
                                              IsEditable="True"
                                              PlaceholderText="é€‰æ‹©æˆ–è¾“å…¥ä¼˜å…ˆçº§..."
                                              HorizontalAlignment="Stretch"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="æ‰€æœ‰ä¼˜å…ˆçº§" FontSize="12" Opacity="0.7"/>
                                    <ScrollViewer MaxHeight="200" HorizontalScrollBarVisibility="Disabled">
                                        <ItemsControl Name="PrioritiesListControl">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid ColumnDefinitions="*,Auto" Margin="0,4">
                                                        <TextBlock Grid.Column="0" 
                                                                   Text="{Binding Name}"
                                                                   VerticalAlignment="Center"/>
                                                        <Button Grid.Column="1"
                                                                Content="&#xE74D;"
                                                                FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                                Padding="4"
                                                                FontSize="12"
                                                                ToolTip.Tip="åˆ é™¤ä¼˜å…ˆçº§"
                                                                Tag="{Binding}"
                                                                Click="DeletePriorityButton_Click"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="æ–°å»ºä¼˜å…ˆçº§" FontSize="12" Opacity="0.7"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0"
                                                 Name="NewPriorityNameTextBox"
                                                 Watermark="è¾“å…¥æ–°ä¼˜å…ˆçº§åç§°..."
                                                 Margin="0,0,8,0"/>
                                        <Button Grid.Column="1"
                                                Content="æ·»åŠ "
                                                Name="AddPriorityButton"
                                                Padding="12,6"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <ui:SymbolIcon Symbol="Flag" FontSize="12"/>
                        <TextBlock Name="PriorityButtonText" 
                                   Text="æ— ä¼˜å…ˆçº§" 
                                   FontSize="11"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- æ ‡ç­¾æŒ‰é’® -->
                <Button Name="TagButton"
                        Padding="8,4"
                        VerticalAlignment="Center"
                        ToolTip.Tip="ç‚¹å‡»ç®¡ç†æ ‡ç­¾">
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Width="250" Spacing="12">
                                <TextBlock Text="ç®¡ç†æ ‡ç­¾" FontSize="14" FontWeight="SemiBold"/>
                                
                                <StackPanel Spacing="4">
                                    <TextBlock Text="å½“å‰æ ‡ç­¾" FontSize="12" Opacity="0.7"/>
                                    <ScrollViewer MaxHeight="150" HorizontalScrollBarVisibility="Disabled">
                                        <WrapPanel Name="CurrentTagsPanel">
                                            <!-- å½“å‰æ ‡ç­¾å°†åŠ¨æ€æ·»åŠ  -->
                                        </WrapPanel>
                                    </ScrollViewer>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="æ·»åŠ æ ‡ç­¾" FontSize="12" Opacity="0.7"/>
                                    <ComboBox Name="TagComboBox"
                                              IsEditable="True"
                                              PlaceholderText="é€‰æ‹©æˆ–è¾“å…¥æ ‡ç­¾..."
                                              HorizontalAlignment="Stretch"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="æ‰€æœ‰æ ‡ç­¾" FontSize="12" Opacity="0.7"/>
                                    <ScrollViewer MaxHeight="200" HorizontalScrollBarVisibility="Disabled">
                                        <ItemsControl Name="TagsListControl">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid ColumnDefinitions="*,Auto" Margin="0,4">
                                                        <TextBlock Grid.Column="0" 
                                                                   Text="{Binding Name}"
                                                                   VerticalAlignment="Center"/>
                                                        <Button Grid.Column="1"
                                                                Content="&#xE74D;"
                                                                FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                                Padding="4"
                                                                FontSize="12"
                                                                ToolTip.Tip="åˆ é™¤æ ‡ç­¾"
                                                                Tag="{Binding}"
                                                                Click="DeleteTagButton_Click"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </StackPanel>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <ui:SymbolIcon Symbol="Tag" FontSize="12"/>
                        <TextBlock Name="TagButtonText" 
                                   Text="æ— æ ‡ç­¾" 
                                   FontSize="11"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- è‡ªå®šä¹‰å­—æ®µæ˜¾ç¤ºåŒºåŸŸ -->
            <WrapPanel Grid.Row="3"
                       Name="CustomFieldsPanel"
                       Margin="0,8,0,0">
                <!-- è‡ªå®šä¹‰å­—æ®µå°†åœ¨ä»£ç ä¸­åŠ¨æ€æ·»åŠ  -->
            </WrapPanel>

            <!-- åˆ›å»ºæ—¶é—´ -->
            <TextBlock Grid.Row="4"
                       Name="CreatedTimeText"
                       Text="åˆ›å»ºäºŽ..."
                       FontSize="10"
                       Opacity="0.5"
                       Margin="0,8,0,0"/>
        </Grid>
    </Border>
</UserControl>

