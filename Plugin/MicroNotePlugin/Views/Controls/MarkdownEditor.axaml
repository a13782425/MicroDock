<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
             xmlns:local="clr-namespace:MicroNotePlugin.Views.Controls"
             xmlns:vm="clr-namespace:MicroNotePlugin.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="450"
             x:Class="MicroNotePlugin.Views.Controls.MarkdownEditor"
             x:DataType="vm:MarkdownEditorViewModel">

    <UserControl.Styles>
        <!-- AvaloniaEdit å¿…éœ€çš„æ ·å¼ -->
        <StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" />
        
        <!-- ç¼–è¾‘å™¨æ ·å¼ -->
        <Style Selector="ae|TextEditor">
            <Setter Property="FontFamily" Value="Consolas, 'Microsoft YaHei', monospace"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="ShowLineNumbers" Value="True"/>
            <Setter Property="WordWrap" Value="True"/>
        </Style>
        
        <!-- ç©ºçŠ¶æ€æç¤ºæ ·å¼ -->
        <Style Selector="StackPanel.empty-state">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*">
        <!-- å·¥å…·æ  -->
        <local:EditorToolbar x:Name="Toolbar" 
                             Grid.Row="0"
                             IsVisible="{Binding HasFile}"/>

        <!-- å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="1">
            <!-- ç©ºçŠ¶æ€ -->
            <StackPanel Classes="empty-state" 
                        IsVisible="{Binding !HasFile}">
                <TextBlock Text="ðŸ“" 
                           FontSize="48" 
                           HorizontalAlignment="Center"
                           Opacity="0.5"/>
                <TextBlock Text="é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªç¬”è®°å¼€å§‹ç¼–è¾‘" 
                           FontSize="16"
                           Opacity="0.6"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
            
            <!-- å•é¢æ¿æ¨¡å¼ï¼ˆä»…ç¼–è¾‘ï¼‰ -->
            <ae:TextEditor x:Name="Editor"
                           IsVisible="{Binding ShowEditOnly}"
                           IsReadOnly="False"
                           Focusable="True"
                           HorizontalScrollBarVisibility="Auto"
                           VerticalScrollBarVisibility="Auto"
                           Margin="0"/>
            
            <!-- å•é¢æ¿æ¨¡å¼ï¼ˆä»…é¢„è§ˆï¼‰ -->
            <Border IsVisible="{Binding ShowPreviewOnly}" Padding="16">
                <md:MarkdownScrollViewer x:Name="PreviewScroller"
                                         Markdown="{Binding MarkdownContent}"/>
            </Border>
            
            <!-- åˆ†å±æ¨¡å¼ -->
            <Grid x:Name="SplitPanel" 
                  IsVisible="{Binding ShowSplitView}"
                  ColumnDefinitions="*,4,*">
                <!-- å·¦ä¾§ç¼–è¾‘å™¨ -->
                <ae:TextEditor x:Name="SplitEditor"
                               Grid.Column="0"
                               IsReadOnly="False"
                               Focusable="True"
                               HorizontalScrollBarVisibility="Auto"
                               VerticalScrollBarVisibility="Auto"
                               Margin="0"/>
                
                <!-- åˆ†éš”æ¡ -->
                <GridSplitter Grid.Column="1" 
                              Width="4"
                              ResizeDirection="Columns"
                              Background="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"/>
                
                <!-- å³ä¾§é¢„è§ˆ -->
                <Border Grid.Column="2" Padding="16">
                    <md:MarkdownScrollViewer x:Name="SplitPreviewScroller"
                                             Markdown="{Binding MarkdownContent}"/>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
