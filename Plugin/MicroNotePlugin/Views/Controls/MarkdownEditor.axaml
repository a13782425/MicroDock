<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
             xmlns:local="clr-namespace:MicroNotePlugin.Views.Controls"
             xmlns:vm="clr-namespace:MicroNotePlugin.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="450"
             x:Class="MicroNotePlugin.Views.Controls.MarkdownEditor"
             x:DataType="vm:MarkdownEditorViewModel">

    <UserControl.Styles>
        <!-- AvaloniaEdit å¿…éœ€çš„æ ·å¼ -->
        <StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" />
        
        <!-- ç¼–è¾‘å™¨æ ·å¼ -->
        <Style Selector="ae|TextEditor">
            <Setter Property="FontFamily" Value="Consolas, 'Microsoft YaHei', monospace"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="ShowLineNumbers" Value="True"/>
            <Setter Property="WordWrap" Value="True"/>
        </Style>
        
        <!-- ç©ºçŠ¶æ€æç¤ºæ ·å¼ -->
        <Style Selector="StackPanel.empty-state">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*">
        <!-- å·¥å…·æ  -->
        <local:EditorToolbar x:Name="Toolbar" 
                             Grid.Row="0"
                             IsVisible="{Binding HasFile}"/>

        <!-- å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="1">
            <!-- ç©ºçŠ¶æ€ -->
            <StackPanel Classes="empty-state" 
                        IsVisible="{Binding !HasFile}">
                <TextBlock Text="ðŸ“" 
                           FontSize="48" 
                           HorizontalAlignment="Center"
                           Opacity="0.5"/>
                <TextBlock Text="é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªç¬”è®°å¼€å§‹ç¼–è¾‘" 
                           FontSize="16"
                           Opacity="0.6"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
            
            <!-- ä¸»å†…å®¹åŒºï¼šç»Ÿä¸€çš„åˆ†æ å¸ƒå±€ -->
            <Grid x:Name="ContentPanel" 
                  IsVisible="{Binding HasFile}"
                  ColumnDefinitions="*,Auto,*">
                
                <!-- ç¼–è¾‘å™¨ï¼ˆç¼–è¾‘æ¨¡å¼å’Œåˆ†å±æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                <ae:TextEditor x:Name="Editor"
                               Grid.Column="0"
                               IsVisible="{Binding ShowEditor}"
                               IsReadOnly="False"
                               Focusable="True"
                               FontWeight="Light"
                               HorizontalScrollBarVisibility="Auto"
                               VerticalScrollBarVisibility="Auto"/>
                
                <!-- åˆ†éš”æ¡ï¼ˆä»…åˆ†å±æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                <GridSplitter x:Name="Splitter"
                              Grid.Column="1" 
                              Width="4"
                              IsVisible="{Binding IsSplitMode}"
                              ResizeDirection="Columns"
                              Background="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"/>
                
                <!-- é¢„è§ˆï¼ˆé¢„è§ˆæ¨¡å¼å’Œåˆ†å±æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                <Border Grid.Column="2" 
                        Padding="16"
                        IsVisible="{Binding ShowPreview}">
                    <md:MarkdownScrollViewer x:Name="PreviewScroller"
                                             Markdown="{Binding MarkdownContent}"/>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
