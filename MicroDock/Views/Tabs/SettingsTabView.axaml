<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="using:MicroDock.ViewModels"
			 xmlns:models="using:MicroDock.Model"
			 xmlns:plugin="using:MicroDock.Plugin"
			 xmlns:db="using:MicroDock.Database"
			 xmlns:fa="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
			 xmlns:controls="using:MicroDock.Views.Controls"
			 mc:Ignorable="d"
			 d:DesignWidth="500"
			 d:DesignHeight="350"
			 x:Class="MicroDock.Views.SettingsTabView"
			 x:DataType="vm:SettingsTabViewModel"
			 x:Name="Root">
	<Design.DataContext>
		<vm:SettingsTabViewModel />
	</Design.DataContext>
	<UserControl.Styles>

	</UserControl.Styles>
	<ScrollViewer HorizontalScrollBarVisibility="Disabled"
				  VerticalScrollBarVisibility="Auto">
		<StackPanel Margin="0,12,12,12" Spacing="8">
			<!-- 基础设置分组 -->
			<fa:SettingsExpander Header="基础设置"
								 IconSource="Setting"
								 IsExpanded="False">
				<StackPanel Margin="10,10,10,10">
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="开机自启动"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<ToggleSwitch IsChecked="{Binding AutoStartup, Mode=TwoWay}"
									  Grid.Column="1"
									  OnContent=""
									  OffContent=""/>
					</Grid>

					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="靠边隐藏"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<ToggleSwitch IsChecked="{Binding AutoHide, Mode=TwoWay}"
									  Grid.Column="1"
									  OnContent=""
									  OffContent=""/>
					</Grid>

					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="窗口置顶"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<ToggleSwitch IsChecked="{Binding AlwaysOnTop, Mode=TwoWay}"
									  Grid.Column="1"
									  OnContent=""
									  OffContent=""/>
					</Grid>

					<!-- 主题设置 -->
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="200"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="主题"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<controls:GroupedComboBox Grid.Column="1"
												  GroupedItemsSource="{Binding GroupedThemes}"
												  SelectedItem="{Binding SelectedThemeModel, Mode=TwoWay}"
												  DisplayMemberPath="DisplayName"
												  PlaceholderText="选择主题..."
												  IsGroupCollapsible="False"
												  MaxDropDownHeight="300">
							<controls:GroupedComboBox.ItemTemplate>
								<DataTemplate DataType="models:ThemeModel">
									<TextBlock Text="{Binding DisplayName}"
											   FontSize="13"/>
								</DataTemplate>
							</controls:GroupedComboBox.ItemTemplate>
						</controls:GroupedComboBox>
					</Grid>
				</StackPanel>
			</fa:SettingsExpander>

			<!-- 页签管理分组 -->
			<fa:SettingsExpander Header="页签管理"
								 IconSource="Library"
								 IsExpanded="False">
				<StackPanel Margin="10">
					<TextBlock Text="导航栏顺序与密码锁定" FontWeight="SemiBold" Margin="0,0,0,8"/>
					<controls:ReorderableListBox ItemsSource="{Binding NavigationTabs}"
												 OrderChangedCommand="{Binding SaveTabOrderCommand}">
						<controls:ReorderableListBox.ItemTemplate>
							<DataTemplate DataType="vm:NavigationTabSettingItem">
								<Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
										BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
										BorderThickness="1"
										CornerRadius="4"
										Padding="8"
										Margin="0,4">
									<Grid Background="Transparent">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto"/>
											<!-- IsVisible -->
											<ColumnDefinition Width="*"/>
											<!-- Name -->
											<ColumnDefinition Width="Auto"/>
											<!-- Lock Badge -->
											<ColumnDefinition Width="Auto"/>
											<!-- Lock Button -->
										</Grid.ColumnDefinitions>

										<CheckBox IsChecked="{Binding IsVisible}" Grid.Column="0" Margin="0,0,12,0" ToolTip.Tip="是否显示"/>

										<StackPanel Grid.Column="1" VerticalAlignment="Center">
											<TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
											<TextBlock Text="{Binding UniqueId}" FontSize="10" Foreground="Gray" TextTrimming="CharacterEllipsis"/>
										</StackPanel>

										<!-- 锁定徽章 -->
										<fa:InfoBadge Grid.Column="2"
													  Margin="8,0"
													  VerticalAlignment="Center"
													  IsVisible="{Binding IsLocked}">
											<fa:InfoBadge.IconSource>
												<fa:SymbolIconSource Symbol="Permissions"/>
											</fa:InfoBadge.IconSource>
										</fa:InfoBadge>

										<!-- 密码设置按钮 -->
										<Button Grid.Column="3" Content="{Binding PasswordButtonText}"
												Command="{Binding SetPasswordCommand}"
												Padding="8,4"
												FontSize="12"/>
									</Grid>
								</Border>
							</DataTemplate>
						</controls:ReorderableListBox.ItemTemplate>
					</controls:ReorderableListBox>
				</StackPanel>
			</fa:SettingsExpander>

			<!-- 插件管理分组 -->
			<fa:SettingsExpander Header="插件管理"
								 IconSource="ViewAll"
								 Description="查看、导入和管理插件">
				<fa:SettingsExpander.Footer>
					<StackPanel Orientation="Horizontal" Spacing="8">
						<Button Content="打开插件文件夹"
								Command="{Binding OpenPluginsFolderCommand}"/>
						<Button Content="导入插件"
								Command="{Binding ImportPluginCommand}"/>
						<Button Content="安装插件"
								Command="{Binding InstallPluginCommand}"
								Classes="accent"/>
					</StackPanel>
				</fa:SettingsExpander.Footer>
				<ItemsControl ItemsSource="{Binding PluginSettings}" Margin="0,0,0,0">
					<ItemsControl.ItemTemplate>
						<DataTemplate x:DataType="vm:PluginSettingItem">
							<controls:PluginSettingCard/>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</fa:SettingsExpander>

			<!-- 高级设置分组 -->
			<fa:SettingsExpander Header="高级设置"
								 IconSource="Code">
				<StackPanel Margin="10,10,10,10">
					<!-- 显示日志查看器选项 -->
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="显示日志查看器"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<ToggleSwitch IsChecked="{Binding ShowLogViewer, Mode=TwoWay}"
									  Grid.Column="1"
									  OnContent=""
									  OffContent=""/>
					</Grid>
					<!-- 显示资源查看器选项 -->
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="显示资源查看器"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<ToggleSwitch IsChecked="{Binding ShowResViewer, Mode=TwoWay}"
									  Grid.Column="1"
									  OnContent=""
									  OffContent=""/>
					</Grid>
					<!-- 服务器设置 -->
					<TextBlock Text="服务器设置"
							   FontSize="13"
							   FontWeight="SemiBold"
							   Margin="0,15,0,8"
							   Foreground="#666"/>
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="100"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="服务器地址"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<TextBox Text="{Binding ServerAddress, Mode=TwoWay}"
								 Watermark="http://your-server.com"
								 Grid.Column="1"
								 Margin="0,0,8,0"/>
						<Button Content="测试连接"
								Command="{Binding TestConnectionCommand}"
								Grid.Column="2"/>
					</Grid>
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="100"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="备份地址"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<TextBox Text="{Binding BackupServerAddress, Mode=TwoWay}"
								 Watermark="可选，为空时使用服务器地址"
								 Grid.Column="1"/>
					</Grid>
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="100"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="服务器Key"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<TextBox Text="{Binding ServerValidationKey, Mode=TwoWay}"
								 PasswordChar="●"
								 Watermark="用于验证客户端身份，防止恶意提交"
								 Grid.Column="1"/>
					</Grid>
					<!-- 数据备份 -->
					<TextBlock Text="数据备份"
							   FontSize="13"
							   FontWeight="SemiBold"
							   Margin="0,15,0,8"
							   Foreground="#666"/>
					<Grid Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="100"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="备份密码"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<TextBox Text="{Binding BackupPassword, Mode=TwoWay}"
								 PasswordChar="●"
								 Watermark="用于加密备份数据"
								 Grid.Column="1"/>
					</Grid>
					<Grid Margin="0,8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="100"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Text="主程序数据"
								   VerticalAlignment="Center"
								   Grid.Column="0"/>
						<Button Content="备份"
								Command="{Binding BackupAppDataCommand}"
								Grid.Column="1"
								Margin="0,0,8,0"/>
						<Button Content="恢复"
								Command="{Binding RestoreAppDataCommand}"
								Grid.Column="2"/>
						<TextBlock Grid.Column="3"
								   VerticalAlignment="Center"
								   Margin="16,0,0,0"
								   Foreground="Gray"
								   FontSize="11">
							<Run Text="上次备份: "/>
							<Run Text="{Binding LastAppBackupTimeText}"/>
						</TextBlock>
					</Grid>
					<TextBlock Text="提示: 插件数据备份请在各插件的更多菜单中操作"
							   Foreground="Gray"
							   FontSize="11"
							   Margin="0,4"/>

					<!-- 调试选项 -->
					<TextBlock Text="调试选项"
							   FontSize="13"
							   FontWeight="SemiBold"
							   Margin="0,15,0,8"
							   Foreground="#666"/>
					<TextBlock Text="调试工具待实现..."
							   Foreground="Gray"
							   FontSize="12"
							   Margin="0,4"/>
				</StackPanel>
			</fa:SettingsExpander>

			<!-- 关于信息 -->
			<Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
					BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
					BorderThickness="1"
					CornerRadius="8"
					Padding="16"
					Margin="0,8,0,0"
					HorizontalAlignment="Stretch">
				<StackPanel Spacing="4">
					<TextBlock Text="关于 MicroDock"
							   FontSize="14"
							   FontWeight="SemiBold"/>
					<TextBlock Text="版本: 1.0.0.0"
							   FontSize="12"
							   Opacity="0.7"/>
					<TextBlock Text="轻量级桌面工具栏应用"
							   FontSize="12"
							   Opacity="0.7"/>
				</StackPanel>
			</Border>
		</StackPanel>
	</ScrollViewer>
</UserControl>

