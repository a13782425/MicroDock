# 开发准则和最佳实践

## 🚫 重要开发准则

### 端口管理准则
- **严禁随意更改端口**：一旦确定端口，就不要随意更改
- **标准端口配置**：
  - 前端开发：`http://localhost:3000`
  - 后端开发：`http://localhost:8000` ⚠️ 已从8001修正为8000
- **端口冲突处理**：
  1. **先清理，后启动**：启动新服务前，必须先停止占用该端口的旧服务
  2. **检查端口占用**：使用 `netstat -ano | findstr :3000` 检查端口状态
  3. **强制清理进程**：使用 `powershell "Stop-Process -Id <进程ID> -Force"`
  4. **验证清理完成**：确保端口完全释放后再启动新服务
- **环境变量配置**：
  - 后端：`backend/.env` 文件中配置 `PORT=8000`
  - 前端：`frontend/.env` 文件中配置 `VITE_API_BASE_URL=http://localhost:8000/api`
- **端口验证顺序**：
  1. 先启动后端服务（端口8000）
  2. 再启动前端服务（端口3000）
  3. 验证：`http://localhost:8000/health` 和 `http://localhost:3000`

### 服务管理准则
```bash
# 错误的做法：直接启动新服务，导致端口递增
npm run dev  # 可能会变成3001, 3002, 3003...

# 正确的做法：
# 1. 检查端口占用
netstat -ano | findstr :3000

# 2. 停止占用进程
taskkill /F /PID <进程ID>
# 或者
powershell "Stop-Process -Id <进程ID> -Force"

# 3. 验证端口已释放
netstat -ano | findstr :3000

# 4. 启动服务（现在会使用正确的3000端口）
npm run dev
```

## 🛠️ 开发工作流准则

### 1. 环境启动流程
1. **先启动后端**：`python start_local.py` (端口8000)
2. **再启动前端**：`npm run dev` (端口3000)
3. **验证服务**：
   - 后端：http://localhost:8000/health
   - 前端：http://localhost:3000

### 2. 代码修改后重启
- **后端修改**：重启后端服务
- **前端修改**：Vite会自动热重载，无需重启
- **端口配置修改**：重启对应服务

### 3. 问题排查流程
1. **检查服务状态**：确认两个服务都在运行
2. **检查端口占用**：使用netstat命令
3. **检查日志输出**：查看控制台错误信息
4. **清理冲突进程**：按上述端口管理准则操作

## 📝 其他重要准则

### 文件命名规范
- 使用kebab-case：`plugin-parser.py` 而不是 `plugin_parser.py`
- 组件使用PascalCase：`PluginUpload.vue`
- API端点使用复数：`/api/plugins` 而不是 `/api/plugin`

### 错误处理规范
- 前端：使用try-catch包装异步操作
- 后端：提供用户友好的错误消息
- 日志：记录详细的错误信息用于调试

### 安全准则
- 永远验证用户输入
- 使用临时文件处理上传
- 清理临时资源
- 验证文件类型和大小

### Git提交规范
- 使用语义化提交信息
- 一个提交只做一件事
- 提交前测试功能正常

## 📋 端口问题修复案例研究

### 问题场景：端口配置不一致
**日期**：2025-11-18
**问题描述**：后端服务从8000端口意外迁移到8001端口，导致前后端连接失败

### 修复步骤
1. **问题识别**：
   - 用户反馈："我记得你之前说后端是8000 怎么变成8001了?"
   - 发现多个后端进程同时运行在不同端口

2. **冲突解决**：
   ```bash
   # 检查端口占用
   netstat -ano | findstr :8000
   # 停止占用进程
   powershell "Stop-Process -Id <进程ID> -Force"
   ```

3. **配置标准化**：
   - 更新 `backend/.env`：`PORT=8000`
   - 更新 `frontend/.env`：`VITE_API_BASE_URL=http://localhost:8000/api`
   - 重启服务应用新配置

4. **验证修复**：
   - 后端健康检查：`curl http://localhost:8000/health`
   - 前端访问：`http://localhost:3000`
   - API连接测试

### 经验教训
- ✅ **环境变量优先**：使用.env文件确保配置一致性
- ✅ **清理旧进程**：启动新服务前必须清理占用端口的进程
- ✅ **验证顺序**：先后端，再前端，最后验证连接
- ✅ **文档更新**：修复后立即更新开发文档

---

**记住**：端口一致性是开发环境稳定的基础，任何时候都不要随意更改标准端口配置！