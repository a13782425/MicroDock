# MicroDock ZIP插件存储器管理系统

## 🎯 系统概述

这是一个专门为MicroDock设计的插件存储器管理系统，支持**ZIP格式插件包**的存储和管理。与传统的运行时插件不同，这些插件是只读的存储器，主要用于插件的存储、分发和版本管理。

## 🚀 核心特性

### 🔧 支持的插件格式
- **ZIP插件包** (推荐): 包含`plugin.json`配置文件的完整插件包
- **DLL文件** (兼容): 传统插件文件，向后兼容支持

### 📦 ZIP插件包结构
```
YourPlugin.zip
├── plugin.json          # 必需：插件配置文件（根目录）
├── README.md            # 可选：插件说明文档
├── main.py              # 可选：主程序文件
├── assets/              # 可选：资源文件夹
│   ├── icon.png
│   └── config.json
└── lib/                 # 可选：依赖库文件夹
    └── helper.py
```

### ⚡ 主要功能
- **插件上传**: 支持拖拽上传ZIP和DLL文件
- **插件列表**: 显示所有已存储插件的详细信息
- **版本管理**: 获取和管理插件版本信息
- **插件下载**: 下载原始插件包
- **内容浏览**: 查看ZIP包内的文件列表（仅限ZIP）
- **安全删除**: 删除前自动创建备份

## 📊 管理界面功能

### 📈 统计信息
- 总插件数量
- 存储器插件数量
- 传统插件数量
- 总存储大小

### 🔍 搜索和过滤
- **按名称搜索**: 实时搜索插件名称
- **按类型过滤**: 存储器插件 vs 传统插件
- **按格式过滤**: ZIP包 vs DLL文件

### 🎛️ 操作功能
- **下载**: 下载原始插件文件
- **详情**: 查看插件的完整信息
- **内容**: 浏览ZIP包内的文件列表（仅限ZIP）
- **删除**: 安全删除插件（自动备份）

## 🛠️ API接口文档

### 插件管理
```http
# 获取所有插件
GET /api/plugins
响应: {"success": true, "data": [插件列表]}

# 获取插件版本
GET /api/plugins/<plugin_name>/version
响应: {"success": true, "version": "1.2.3"}

# 下载插件
GET /api/plugins/<plugin_name>/download
响应: 直接下载文件

# 删除插件
DELETE /api/plugins/<plugin_name>/delete
响应: {"success": true, "message": "插件已删除"}
```

### 文件管理
```http
# 上传插件
POST /api/upload
Content-Type: multipart/form-data
plugin_file: [ZIP或DLL文件]

# 重新扫描插件
POST /api/scan
响应: {"success": true, "message": "扫描完成", "data": [...]}

# 获取插件内容（仅限ZIP）
GET /api/plugins/<plugin_name>/contents
响应: {"success": true, "data": ["plugin.json", "README.md", ...]}

# 获取备份列表
GET /api/backups
响应: {"success": true, "data": [备份列表]}

# 下载备份文件
GET /download/backup/<backup_name>
响应: 直接下载备份文件
```

## 📝 plugin.json配置文件格式

ZIP插件包必须包含根目录的`plugin.json`文件：

```json
{
    "name": "Plugin Name",
    "version": "1.0.0",
    "description": "插件描述信息",
    "author": "作者名称",
    "type": "storage",
    "dependencies": ["MicroDock.Plugin", "System.Reactive"],
    "keywords": ["storage", "plugin"],
    "homepage": "https://github.com/example/plugin",
    "license": "MIT"
}
```

### 配置字段说明
- `name`: 插件名称（必需）
- `version`: 版本号（必需，建议使用语义化版本）
- `description`: 插件描述（推荐）
- `author`: 作者信息（推荐）
- `type`: 插件类型（固定为"storage"）
- `dependencies`: 依赖项列表（可选）
- `keywords`: 关键词标签（可选）
- `homepage`: 项目主页（可选）
- `license`: 许可证信息（可选）

## 🚀 快速开始

### 1. 启动服务
```bash
cd PluginServer
python start.py
```

### 2. 访问界面
- 浏览器打开: http://localhost:5000

### 3. 上传插件包
- 点击"上传插件包"按钮
- 拖拽或选择ZIP/DLL文件
- 等待上传完成

### 4. 管理插件
- 在主界面查看所有插件
- 使用搜索和过滤功能快速定位
- 点击相应按钮进行下载、详情、内容查看或删除操作

## 🎯 使用场景

### 📦 插件分发
- **开发者**: 将插件打包为ZIP进行分发
- **用户**: 下载和管理插件包
- **系统**: 统一的插件版本管理

### 🔒 版本控制
- **存储**: 保存不同版本的插件包
- **回滚**: 通过备份功能快速回滚到旧版本
- **追踪**: 记录插件的版本变更历史

### 📋 库存管理
- **清单**: 维护可用的插件清单
- **分类**: 按类型和功能对插件进行分类
- **统计**: 查看插件使用情况和存储统计

## ⚡ 性能优化

### 🗄️ 存储优化
- **自动备份**: 删除时自动创建备份
- **压缩存储**: ZIP格式天然支持压缩
- **缓存机制**: 插件信息自动缓存

### 🔄 处理优化
- **异步上传**: 文件上传不阻塞界面
- **增量扫描**: 只扫描变更的文件
- **实时反馈**: 操作结果即时显示

## 🔒 安全特性

### 🛡️ 文件安全
- **格式验证**: 只接受ZIP和DLL文件
- **大小限制**: 防止超大文件上传
- **路径检查**: 防止路径遍历攻击

### 📝 操作安全
- **自动备份**: 删除前强制备份
- **操作确认**: 重要操作需要用户确认
- **异常处理**: 完善的错误处理机制

## 🎨 界面预览

### 主界面
- **顶部导航**: 插件列表、上传插件包、备份管理
- **统计卡片**: 实时显示插件统计数据
- **插件网格**: 卡片式展示所有已安装插件

### 插件卡片
- **状态标识**: 存储器类型/传统类型标识
- **基本信息**: 名称、版本、作者、大小、时间
- **操作按钮**: 下载、详情、内容、删除

### 功能模态框
- **上传界面**: 拖拽上传，支持ZIP和DLL
- **详情界面**: 完整的插件信息展示
- **内容界面**: ZIP包文件列表浏览

## 🔧 故障排除

### 常见问题

**Q: ZIP文件上传失败？**
A: 确保ZIP文件根目录包含`plugin.json`文件

**Q: 插件信息显示不正确？**
A: 检查`plugin.json`格式是否正确，字段是否完整

**Q: 无法下载插件？**
A: 检查文件是否存在，确认文件权限设置

**Q: 备份文件在哪里？**
A: 备份文件存储在`backups/`目录下

### 调试模式
启动服务器时会显示详细的日志信息：
- 插件扫描过程
- 文件处理结果
- 错误和警告信息

## 📁 目录结构

```
PluginServer/
├── app.py                    # 主应用程序
├── start.py                  # 启动脚本
├── requirements.txt          # Python依赖
├── templates/               # HTML模板
│   ├── base.html           # 基础模板
│   └── index.html          # 主页模板
├── Plugins/                # 插件存储目录
│   ├── TestStoragePlugin.zip
│   └── OtherPlugin.dll
├── backups/                # 备份目录
├── temp/                   # 临时文件目录
└── docs/                   # 文档目录
    ├── ZIP插件管理说明.md
    └── 使用说明.md
```

## 🎉 更新日志

### v2.0.0 (2024-01-01)
- ✨ 新增ZIP插件包支持
- ✨ 新增插件内容浏览功能
- ✨ 新增版本管理API
- 🔧 移除启用/禁用功能（存储器类型）
- 🔧 优化界面适配存储器插件
- 🔧 增强ZIP文件解析和验证

### v1.0.0 (2024-01-01)
- ✨ 初始版本发布
- ✨ 基础插件管理功能
- ✨ Web界面和API接口
- ✨ 文件上传和下载
- ✨ 备份和恢复功能

---

**🎊 祝您使用愉快！**

这是一个完整的MicroDock ZIP插件存储器管理系统，专为插件存储、分发和管理而设计。