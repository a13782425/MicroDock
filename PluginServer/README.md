# MicroDock æ’ä»¶æœåŠ¡å™¨

ä¸€ä¸ªç°ä»£åŒ–çš„æ’ä»¶ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å’Œåˆ†å‘ MicroDock åº”ç”¨çš„æ’ä»¶ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¿«é€Ÿå¯åŠ¨** - ä¸€é”®å¯åŠ¨å‰åç«¯æœåŠ¡
- ğŸ” **å¯†é’¥éªŒè¯** - æ’ä»¶ä¸Šä¼ æ—¶ç»‘å®šå¯†é’¥ï¼Œç¡®ä¿å®‰å…¨æ€§
- ğŸ’¾ **ç”¨æˆ·å¤‡ä»½** - æ”¯æŒæŒ‰ç”¨æˆ·å¤‡ä»½ä¸»ç¨‹åºå’Œæ’ä»¶
- ğŸ“¦ **ç‰ˆæœ¬ç®¡ç†** - å®Œæ•´çš„æ’ä»¶ç‰ˆæœ¬å†å²è®°å½•
- ğŸ¨ **ç°ä»£åŒ– UI** - åŸºäº Vue 3 + Tailwind CSS çš„ç¾è§‚ç•Œé¢
- ğŸ”” **å®æ—¶é€šçŸ¥** - Toast é€šçŸ¥æç¤ºæ“ä½œç»“æœ
- âš™ï¸ **çµæ´»é…ç½®** - æ”¯æŒç¯å¢ƒå˜é‡é…ç½®

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **Python**: 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Node.js**: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd PluginServer
```

### 2. ä¸€é”®å¯åŠ¨

```bash
python start.py
```

å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ Python å’Œ Node.js ç¯å¢ƒ
- âœ… å®‰è£…åç«¯ä¾èµ–ï¼ˆpip installï¼‰
- âœ… å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆnpm installï¼‰
- âœ… å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£ 8000ï¼‰
- âœ… å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£ 3000ï¼‰
- âœ… è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨

### 3. è®¿é—®åº”ç”¨

- **å‰ç«¯ç•Œé¢**: http://localhost:3000
- **åç«¯ API æ–‡æ¡£**: http://localhost:8000/docs

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

é¡¹ç›®æ”¯æŒé€šè¿‡ `.env` æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œé…ç½®æ–‡ä»¶ç¤ºä¾‹ä½äºå„ç›®å½•ï¼š

#### æ ¹ç›®å½•é…ç½® (`env.example.txt`)

ç”¨äºå¯åŠ¨è„šæœ¬çš„é…ç½®ï¼š

```env
# åç«¯æœåŠ¡ç›‘å¬åœ°å€
BACKEND_HOST=0.0.0.0

# åç«¯æœåŠ¡ç«¯å£
BACKEND_PORT=8000

# å‰ç«¯å¼€å‘æœåŠ¡å™¨ç«¯å£
FRONTEND_PORT=3000

# æ˜¯å¦è·³è¿‡ä¾èµ–å®‰è£… (True/False)
SKIP_INSTALL=False

# æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ (True/False)
AUTO_OPEN_BROWSER=True
```

#### åç«¯é…ç½® (`backend/env.example.txt`)

```env
# åº”ç”¨åç§°
APP_NAME=MicroDock Plugin Server

# è°ƒè¯•æ¨¡å¼ (True/False)
DEBUG=True

# æœåŠ¡å™¨ç›‘å¬åœ°å€ (0.0.0.0 å…è®¸å¤–éƒ¨è®¿é—®)
HOST=0.0.0.0

# æœåŠ¡å™¨ç«¯å£
PORT=8000

# æ•°æ®åº“ URL
DATABASE_URL=sqlite+aiosqlite:///./data/plugins.db

# æœ€å¤§ä¸Šä¼ å¤§å° (å­—èŠ‚, é»˜è®¤100MB)
MAX_UPLOAD_SIZE=104857600
```

#### å‰ç«¯é…ç½® (`frontend/env.example.txt`)

```env
# å‰ç«¯å¼€å‘æœåŠ¡å™¨ç«¯å£ (é»˜è®¤ 3000)
VITE_PORT=3000

# åç«¯ API åœ°å€ (ç”¨äºä»£ç†é…ç½®)
VITE_API_URL=http://localhost:8000
```

**ä½¿ç”¨æ–¹æ³•**: å¤åˆ¶ `env.example.txt` ä¸º `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
PluginServer/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ plugins.py     # æ’ä»¶å’Œç‰ˆæœ¬ç®¡ç† API
â”‚   â”‚   â”‚   â”œâ”€â”€ backups.py     # å¤‡ä»½ç®¡ç† API
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py        # è®¤è¯ API
â”‚   â”‚   â”‚   â””â”€â”€ system.py     # ç³»ç»Ÿ API
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ plugin.py      # æ’ä»¶æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ version.py     # ç‰ˆæœ¬æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ backup.py     # å¤‡ä»½æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/           # æ•°æ®éªŒè¯æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ data/                  # æ•°æ®ç›®å½•
â”‚   â”‚   â”œâ”€â”€ plugins.db         # SQLite æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ uploads/           # æ’ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”‚   â”œâ”€â”€ backups/           # å¤‡ä»½æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ temp/              # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”‚   â””â”€â”€ env.example.txt        # åç«¯é…ç½®ç¤ºä¾‹
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.js            # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.vue            # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/        # Vue ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadDialog.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ BackupUploadDialog.vue
â”‚   â”‚   â”‚   â””â”€â”€ VersionDialog.vue
â”‚   â”‚   â”œâ”€â”€ views/             # é¡µé¢è§†å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ PluginList.vue
â”‚   â”‚   â”‚   â””â”€â”€ BackupList.vue
â”‚   â”‚   â”œâ”€â”€ services/          # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ stores/            # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json           # Node.js ä¾èµ–
â”‚   â””â”€â”€ env.example.txt        # å‰ç«¯é…ç½®ç¤ºä¾‹
â”‚
â”œâ”€â”€ start.py                   # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ docker-compose.yml         # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ Dockerfile.backend         # åç«¯ Docker é•œåƒ
â”œâ”€â”€ Dockerfile.frontend         # å‰ç«¯ Docker é•œåƒ
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æ‰‹åŠ¨å¯åŠ¨åç«¯

```bash
cd backend
pip install -r requirements.txt
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### æ‰‹åŠ¨å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

### API æ–‡æ¡£

å¯åŠ¨åç«¯åï¼Œè®¿é—® http://localhost:8000/docs æŸ¥çœ‹äº¤äº’å¼ API æ–‡æ¡£ã€‚

## ğŸ“¦ æ’ä»¶æ ¼å¼

æ’ä»¶å¿…é¡»æ˜¯ ZIP æ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
plugin.zip
â”œâ”€â”€ plugin.json          # æ’ä»¶å…ƒæ•°æ®ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ YourPlugin.dll      # ä¸» DLL æ–‡ä»¶
â””â”€â”€ ...                 # å…¶ä»–ä¾èµ–æ–‡ä»¶
```

### plugin.json æ ¼å¼

```json
{
  "name": "æ’ä»¶åç§°",
  "displayName": "æ˜¾ç¤ºåç§°",
  "version": "1.0.0",
  "description": "æ’ä»¶æè¿°",
  "author": "ä½œè€…å",
  "license": "è®¸å¯è¯",
  "homepage": "https://example.com",
  "main": "YourPlugin.dll",
  "entryClass": "YourPlugin.EntryClass"
}
```

## ğŸ” å¯†é’¥éªŒè¯

### æ’ä»¶å¯†é’¥

- ä¸Šä¼ æ’ä»¶æ—¶å¿…é¡»æä¾› `plugin_key`
- é¦–æ¬¡ä¸Šä¼ æ—¶ï¼Œå¯†é’¥ä¼šç»‘å®šåˆ°æ’ä»¶
- åç»­æ›´æ–°åŒåæ’ä»¶æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†é’¥
- å¯†é’¥æ ¼å¼ï¼šä»…åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œæœ€å¤§é•¿åº¦ 256 å­—ç¬¦

### ç”¨æˆ·å¯†é’¥

- ç”¨äºç”¨æˆ·å¤‡ä»½åŠŸèƒ½
- æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰å”¯ä¸€çš„ `user_key`
- å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨ `data/backups/{user_key}/` ç›®å½•
- å¯†é’¥æ ¼å¼ï¼šåŒä¸Š

## ğŸ“Š æ•°æ®æ¨¡å‹

### Plugin (æ’ä»¶)
- **ä¸»é”®**: `name` (å­—ç¬¦ä¸²ï¼Œå”¯ä¸€æ ‡è¯†ç¬¦)
- ä¸ä½¿ç”¨æ•´æ•° IDï¼Œæ’ä»¶åå³ä¸ºå”¯ä¸€æ ‡è¯†

### PluginVersion (æ’ä»¶ç‰ˆæœ¬)
- **è”åˆä¸»é”®**: `(plugin_name, version)`
- ä½¿ç”¨"æ’ä»¶å + ç‰ˆæœ¬å·"å®šä½ä»»æ„ç‰ˆæœ¬
- æ–‡ä»¶å‘½åæ ¼å¼: `æ’ä»¶å@ç‰ˆæœ¬.zip`
- å­˜å‚¨ç›®å½•: `data/uploads/{plugin_name}/`

## ğŸ³ Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
docker-compose up -d
```

### æ„å»ºé•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒ
docker build -f Dockerfile.backend -t plugin-server-backend .

# æ„å»ºå‰ç«¯é•œåƒ
docker build -f Dockerfile.frontend -t plugin-server-frontend .
```

## ğŸ“ API ä½¿ç”¨è§„èŒƒ

### è¯·æ±‚æ–¹æ³•

- **GET**: ä»…ç”¨äºæ— å‚æ•°çš„æŸ¥è¯¢æ“ä½œ
- **POST**: ç”¨äºæ‰€æœ‰å¸¦å‚æ•°çš„æ“ä½œï¼ˆåŒ…æ‹¬æŸ¥è¯¢ï¼‰

### URL è§„èŒƒ

- URL ä¸­ä¸åŒ…å«å‚æ•°
- æ‰€æœ‰å‚æ•°é€šè¿‡è¯·æ±‚ä½“ï¼ˆJSONï¼‰ä¼ é€’

### æ’ä»¶ç®¡ç† API

**æ‰€æœ‰æ’ä»¶æ“ä½œä½¿ç”¨æ’ä»¶å (`name`) ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œä¸ä½¿ç”¨å†…éƒ¨ IDï¼š**

| ç«¯ç‚¹ | è¯·æ±‚ä½“ | è¯´æ˜ |
|------|--------|------|
| `GET /api/plugins/list` | æ—  | è·å–æ’ä»¶åˆ—è¡¨ |
| `POST /api/plugins/detail` | `{"name": "xxx"}` | è·å–æ’ä»¶è¯¦æƒ… |
| `POST /api/plugins/enable` | `{"name": "xxx"}` | å¯ç”¨æ’ä»¶ (ç®¡ç†å‘˜) |
| `POST /api/plugins/disable` | `{"name": "xxx"}` | ç¦ç”¨æ’ä»¶ (ç®¡ç†å‘˜) |
| `POST /api/plugins/delete` | `{"name": "xxx"}` | åˆ é™¤æ’ä»¶ (ç®¡ç†å‘˜) |
| `POST /api/plugins/download` | `{"name": "xxx"}` | ä¸‹è½½å½“å‰ç‰ˆæœ¬ |

### ç‰ˆæœ¬ç®¡ç† API

**ç‰ˆæœ¬æ“ä½œä½¿ç”¨"æ’ä»¶å + ç‰ˆæœ¬å·"ä½œä¸ºè”åˆæ ‡è¯†ç¬¦ï¼š**

| ç«¯ç‚¹ | è¯·æ±‚ä½“ | è¯´æ˜ |
|------|--------|------|
| `POST /api/plugins/versions` | `{"name": "xxx"}` | è·å–ç‰ˆæœ¬åˆ—è¡¨ |
| `POST /api/plugins/version/detail` | `{"name": "xxx", "version": "1.0.0"}` | è·å–ç‰ˆæœ¬è¯¦æƒ… |
| `POST /api/plugins/version/download` | `{"name": "xxx", "version": "1.0.0"}` | ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ |
| `POST /api/plugins/version/deprecate` | `{"name": "xxx", "version": "1.0.0"}` | æ ‡è®°ç‰ˆæœ¬è¿‡æ—¶ (ç®¡ç†å‘˜) |

### ç¤ºä¾‹

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ’ä»¶åæŸ¥è¯¢
POST /api/plugins/detail
Body: { "name": "com.example.plugin" }

// âœ… æ­£ç¡®ï¼šç‰ˆæœ¬ API ä½¿ç”¨æ’ä»¶å + ç‰ˆæœ¬å·
POST /api/plugins/version/download
Body: { "name": "com.example.plugin", "version": "1.0.0" }

// âŒ é”™è¯¯ï¼šURL ä¸­åŒ…å«å‚æ•°
GET /api/plugins/com.example.plugin
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

A: ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®ï¼Œæˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹ã€‚

### Q: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ

A: åˆ é™¤ `backend/data/plugins.db` æ–‡ä»¶ï¼Œé‡å¯æœåŠ¡ä¼šè‡ªåŠ¨åˆ›å»ºæ–°æ•°æ®åº“ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ

A: åç«¯æ—¥å¿—åœ¨ç»ˆç«¯è¾“å‡ºï¼Œå‰ç«¯æ—¥å¿—åœ¨æµè§ˆå™¨æ§åˆ¶å°ã€‚

### Q: ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ï¼š
1. æ–‡ä»¶æ˜¯å¦ä¸º ZIP æ ¼å¼
2. ZIP å†…æ˜¯å¦åŒ…å« `plugin.json`
3. `plugin.json` æ ¼å¼æ˜¯å¦æ­£ç¡®
4. å¯†é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®

## ğŸ“„ è®¸å¯è¯

[æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µå¡«å†™]

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ è”ç³»æ–¹å¼

[æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µå¡«å†™]

